<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="shortcut icon" href="favicon.ico">

        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
              integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
        <style>
            input[type="text"] {
                width: 100px;
            }
            .left-margin {
                margin-left: 30px;
            }
            .clear-both {
                clear: both;
            }
            .display-none {
                display: none;
            }
            .top-padding {
                min-height: 75rem;
                padding-top: 4.5rem;
            }
            .fg-blur {
                backdrop-filter: blur(4px);
            }
            .bg-blur {
                filter: blur(4px);
            }
            .hide-all,#otherResetZoom {
                margin-left: 30px;
            }
            #plotControls > div > label {
                margin-right: 10px;
            }
            #updateBtn {
                margin-left: 30px;
            }
            #latestDiv {
                margin-top: 15px;
                margin-bottom: 10px;
            }
            #latestCheckboxDiv {
                margin-bottom: 15px;
                font-size: 0.8em;
            }
            #startDate,#endDate {
                width: 140px;
            }
            #noDataError {
                width: 50%;
                margin-top: 20px;
            }
            #weatherDiv,#otherDiv {
                width: 1300px;
                height: 730px;
            }
            #elecPriceDiv {
                width: 1200px;
                height: 480px;
            }
            #otherCheckboxDiv,#elecPriceCheckboxDiv,#imageButtonDiv {
                margin-top: 20px;
                margin-bottom: 10px;
            }
            #lastObservation,#forecast {
                font-size: 0.9em;
            }
            #loadingSpinner {
                backdrop-filter: blur(10px);
                width: 3.5em;
                height: 3.5em;
            }
            #imageButtonDiv {
                margin-top: 20px;
                margin-bottom: 20px;
            }
        </style>

        <title>Environment log viewer - observations</title>
    </head>
    <body class="top-padding">
        <div id="bodyDiv">
            <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
                <div class="container-fluid">
                    <a class="navbar-brand" href="#">Environment logger</a>
                    <ul class="navbar-nav">
                        {% if logged-in? %}
                            <li class="nav-item">
                                <a class="nav-link" href="logout">Log out</a>
                            </li>
                        {% else %}
                            <li>
                                <a class="nav-link" href="login">Log in</a>
                            </li>
                        {% endif %}
                    </ul>
                </div>
            </nav>

            <div class="left-margin clear-both">
                <h4>Date interval to show</h4>
                <form method="get" action="">
                    <input type="date" name="startDate" id="startDate" value="{{ start-date }}"
                           {% if not obs-dates.start|empty? %}min="{{ obs-dates.start }}"{% endif %}
                           {% if not obs-dates.end|empty? %}max="{{ obs-dates.end }}"{% endif %}>
                    &nbsp;-&nbsp;
                    <input type="date" name="endDate" id="endDate" value="{{ end-date }}"
                           {% if not obs-dates.start|empty? %}min="{{ obs-dates.start }}"{% endif %}
                           {% if not obs-dates.end|empty? %}max="{{ obs-dates.end }}"{% endif %}>
                    <input type="button" class="btn btn-primary" id="updateBtn" value="Update">
                </form>
            </div>

            <div class="left-margin display-none" id="latestDiv">
                <span id="lastObservation"></span>
                <span id="forecast"></span>
            </div>

            <div class="left-margin display-none alert alert-danger" id="noDataError" role="alert">
                No observations found
            </div>
            {% if logged-in? %}
                <div class="left-margin" id="latestCheckboxDiv">
                    <input type="checkbox" id="showLatestObs" checked>
                    <label for="showLatestObs">Show above info</label>
                </div>

                <div class="left-margin" id="weatherCheckboxDiv">
                    <input type="checkbox" id="showWeatherChart" checked>
                    <label for="showWeatherChart">Show weather chart</label>
                </div>
            {% endif %}
            <div class="left-margin" id="weatherDiv">
                <canvas id="weatherChart" width="1300" height="700"></canvas>

                <input type="button" id="weatherResetZoom" class="btn btn-light" value="Reset chart zoom" />
                <input type="button" id="weatherHideAll" class="btn btn-danger hide-all" value="Hide all series" />
            </div>

            {% if logged-in? %}
                <div class="left-margin" id="otherCheckboxDiv">
                    <input type="checkbox" id="showOtherChart" checked>
                    <label for="showOtherChart">Show other chart</label>
                </div>
                <div class="left-margin" id="otherDiv">
                    <canvas id="otherChart" width="1300" height="700"></canvas>

                    <input type="button" id="ruuvitagMode" class="btn btn-secondary" value="Show only RuuviTags" />
                    <input type="button" id="otherResetZoom" class="btn btn-light" value="Reset chart zoom" />
                    <input type="button" id="otherHideAll" class="btn btn-danger hide-all" value="Hide all series" />
                </div>

                <div class="left-margin" id="elecPriceCheckboxDiv">
                    <input type="checkbox" id="showElecPriceChart">
                    <label for="showElecPriceChart">Show electricity price chart</label>
                </div>
                <div class="display-none left-margin" id="elecPriceDiv">
                    <canvas id="elecPriceChart" width="1200" height="450"></canvas>

                    <input type="button" id="elecPriceResetZoom" class="btn btn-light" value="Reset chart zoom" />
                </div>
            {% endif %}

            <div id="imageButtonDiv" class="left-margin">
                <input type="checkbox" id="showImages">
                <label for="showImages">Show Testbed image</label>
            </div>
            <div id="imageDiv" class="left-margin display-none" style="margin-bottom: 20px;">
                <img src="" id="testbedImage" alt="FMI Testbed image">
            </div>
        </div>

        <div id="loadingSpinner" class="spinner-border position-absolute top-50 start-50 display-none" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
                integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js@4.1.2/dist/chart.umd.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/luxon@3.2.1/build/global/luxon.min.js"
                integrity="sha256-eTuW4qNdO+s5QEVrZ6g02eMzgyEZmLLuaUscvGF8/t0=" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.3.0/dist/chartjs-adapter-luxon.umd.min.js"
                integrity="sha256-Hds3UubAdScKxDJKEc6REOG5LMvAUB233YREaiWPT+g=" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8/hammer.min.js"
                integrity="sha256-eVNjHw5UeU0jUqPPpZHAkU1z4U+QFBBY488WvueTm88=" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.0/dist/chartjs-plugin-zoom.min.js"
                integrity="sha256-MWgfT8qLAHB0HjurfqDyahw+t9fzVXwbLWKVJ8uTaec=" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@2.1.1/dist/chartjs-plugin-annotation.min.js"
                integrity="sha256-CA6+SlRT+CAUYTwUawUa0w93Gx2sUqwMlnmN1E+hHlo=" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/axios@1.2.2/dist/axios.min.js"
                integrity="sha256-eIET7hisvt1N1cTLix0TTFDQX7fmx0SXQfX5AvDdp0E=" crossorigin="anonymous"></script>
        <script src="js/chart.js"></script>
    </body>
</html>
