<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <title>Environment log viewer - observations</title>

        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
              integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/dygraph/2.1.0/dygraph.min.css" />

        <style>
            body {
                min-height: 75rem;
                padding-top: 4.5rem;
            }
            input[type="text"] {
                width: 100px;
            }
            .left-margin {
                margin-left: 30px;
            }
            .clear-both {
                clear: both;
            }
            .display-none {
                display: none;
            }
            .no-data {
                color: red;
                font-size: 1.2em;
                font-weight: bold;
                display: none;
            }
            .no-profiles {
                font-size: 1.2em;
                font-weight: bold;
            }
            div.dygraph-title {
                font-size: 0.85em;
            }

            #plotControls > div > label {
                margin-right: 10px;
            }
            #yardcamImage {
                height: auto;
                width: auto;
                max-width: 800px;
                max-height: 800px;
            }
            #submitBtn {
                margin-left: 30px;
            }
            #lastObservation {
                margin-top: 30px;
                margin-bottom: 20px;
            }
            #startDate,#endDate {
                width: 140px;
            }
        </style>
    </head>
    <body>
        <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
            <a class="navbar-brand" href="#">Environment logger</a>
            <div class="collapse navbar-collapse" id="navbarCollapse">
                <ul class="navbar-nav mr-auto">
                    <li class="nav-item active">
                        <a class="nav-link" href="#">Observations <span class="sr-only">(current)</span></a>
                    </li>
                </ul>
                <ul class="navbar-nav">
                    {% if logged-in? %}
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-toggle="modal" data-target="#exampleModal">Profiles</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="logout">Log out</a>
                        </li>
                    {% else %}
                        <li>
                            <a class="nav-link" href="login">Log in</a>
                        </li>
                    {% endif %}
                </ul>
            </div>
        </nav>

        {% if logged-in? %}
            <div class="modal fade" id="exampleModal" tabindex="-1">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Profiles</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <span id="noProfiles" class="no-profiles {% if profiles|not-empty %}display-none{% endif %}">No profiles</span>
                            <select id="profiles" {% if profiles|empty? %}class="display-none"{% endif %}>
                                {% for prof in profiles %}
                                    <option value="{{ prof.profile }}">{{ prof.name }}</option>
                                {% endfor %}
                            </select>
                            <br><br>

                            <div id="newProfileDiv" class="display-none">
                                <label for="profileName">Profile name</label><br>
                                <input type="text" name="profileName" id="profileName" style="width: 190px;" maxlength="100">
                            </div>
                        </div>
                        <div class="modal-footer">
                            <div id="profileButtons">
                                <input type="button" class="btn btn-primary {% if profiles|empty? %}display-none{% endif %}" id="applyProfile" value="Apply">
                                <input type="button" class="btn btn-danger {% if profiles|empty? %}display-none{% endif %}" id="deleteProfile" value="Delete">
                                <input type="button" class="btn btn-light" id="newProfile" value="New" style="margin-left: 30px;">
                            </div>
                            <div id="newProfileButtons" class="display-none">
                                <input type="button" class="btn btn-primary" id="saveProfile" value="Save">
                                <input type="button" class="btn btn-danger" id="cancelProfile" value="Cancel">
                            </div>
                            <button type="button" class="btn btn-secondary" data-dismiss="modal" style="margin-left: 30px;">Close</button>
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}
        <div class="left-margin clear-both">
            <h4>Date interval to show</h4>
            <form method="get" action="">
                <input type="date" name="startDate" id="startDate" value="{{start-date}}"
                       {% if not obs-dates.start|empty? %}min="{{obs-dates.start}}"{% endif %}
                       {% if not obs-dates.end|empty? %}max="{{obs-dates.end}}"{% endif %}>
                &nbsp;-&nbsp;
                <input type="date" name="endDate" id="endDate" value="{{end-date}}"
                       {% if not obs-dates.start|empty? %}min="{{obs-dates.start}}"{% endif %}
                       {% if not obs-dates.end|empty? %}max="{{obs-dates.end}}"{% endif %}>
                <input type="submit" class="btn btn-primary" id="submitBtn" value="Refresh">
            </form>
        </div>

        <div class="left-margin display-none" id="lastObservation"></div>

        <div id="graphDiv" style="float: left;">
            <span id="noDataError" class="left-margin no-data">No observations found</span>
        </div>
        <div id="labelDiv" style="float: left;"></div>
        <span id="plotData" class="display-none">{{ data }}</span>

        <div id="plotControls">
            <div class="left-margin clear-both checkboxes">
                {% if logged-in? %}
                    <input type="checkbox" class="selectBox" id="showTemperature">
                    <label for="showTemperature">Inside temperature</label>
                    <input type="checkbox" class="selectBox" id="showOutsideTemperature" checked="checked">
                    <label for="showOutsideTemperature">Temperature (outside)</label>
                    <input type="checkbox" class="selectBox" id="showFMITemperature" checked="checked">
                    <label for="showFMITemperature">Temperature (FMI)</label>
                    <input type="checkbox" class="selectBox" id="showTempDelta" checked="checked">
                    <label for="showTempDelta">Temperature delta</label>
                    <input type="checkbox" id="showAll" style="margin-left: 180px;">
                    <label for="showAll" id="showAllLabel">Show all</label>
                    <br>
                    <input type="checkbox" class="selectBox" id="showBrightness" checked="checked">
                    <label for="showBrightness">Brightness</label>
                    <input type="checkbox" class="selectBox" id="showCloudiness" checked="checked">
                    <label for="showCloudiness">Cloudiness</label>
                    <br>
                    <input type="checkbox" class="selectBox" id="showBeacon" checked="checked">
                    <label id="showBeaconLabel" for="showBeacon">Beacon</label>
                    {% if ruuvitag-enabled? %}
                        <input type="checkbox" class="selectBox" id="showRTTemperature" checked="checked">
                        <label for="showRTTemperature">RuuviTag inside temperature</label>
                        <input type="checkbox" class="selectBox" id="showRTHumidity" checked="checked">
                        <label for="showRTHumidity">RuuviTag humidity</label>
                    {% endif %}
                {% else %}
                    <input type="checkbox" class="selectBox" id="showOutsideTemperature" checked="checked">
                    <label for="showOutsideTemperature">Temperature (outside)</label>
                    <input type="checkbox" class="selectBox" id="showFMITemperature" checked="checked">
                    <label for="showFMITemperature">Temperature (FMI)</label>
                    <input type="checkbox" class="selectBox" id="showTempDelta" checked="checked">
                    <label for="showTempDelta">Temperature delta</label>
                    <input type="checkbox" class="selectBox" id="showCloudiness" checked="checked">
                    <label for="showCloudiness">Cloudiness</label>
                    <input type="checkbox" id="showAll" style="margin-left: 100px;">
                    <label for="showAll" id="showAllLabel">Show all</label>
                {% endif %}
            </div>
        </div>
        <div id="imageButtonDiv" class="left-margin">
            <input type="checkbox" id="showImages">
            <label for="showImages">Show image{% if logged-in? %}s{% endif %}</label>
        </div>
        <div id="imageDiv" class="left-margin display-none" style="margin-bottom: 20px;">
            <img src="" id="testbedImage" alt="FMI Testbed image">
            {% if logged-in? %}
                <a id="yardcamImageLink" href="" target="_blank">
                    <img src="" id="yardcamImage" alt="Yardcam image"
                         style="margin-left: 40px;">
                </a>
            {% endif %}
        </div>

        <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
                integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
                integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/luxon@1.25.0/build/global/luxon.min.js"
                integrity="sha256-OVk2fwTRcXYlVFxr/ECXsakqelJbOg5WCj1dXSIb+nU=" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/axios@0.21.0/dist/axios.min.js"
                integrity="sha256-OPn1YfcEh9W2pwF1iSS+yDk099tYj+plSrCS6Esa9NA=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/dygraph/2.1.0/dygraph.min.js"></script>
        <script>
            var mode = '{% if logged-in? %}all{% else %}weather{% endif %}',
                ruuvitagEnabled = {% if ruuvitag-enabled? %}true{% else %}false{% endif %},
                ycImageBasepath = '{{ yc-image-basepath }}',
                tbImageBasepath = '{{ tb-image-basepath }}',
                socket = new WebSocket('{{ ws-url }}');
        </script>
        <script src="js/plots.js"></script>
        {% if logged-in? %}
            <script src="js/profiles.js"></script>
        {% endif %}
    </body>
</html>
