<!DOCTYPE html>
<html>
    <head>
        <title>Environment log viewer - plots</title>
        <meta charset="utf-8" />

        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
              integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
              crossorigin="anonymous">
        <link rel="stylesheet" href="css/bootstrap-datepicker.min.css">
        <style>
            input[type="text"] {
                width: 100px;
            }
            .leftMargin {
                margin-left: 30px;
            }
            .clearBoth {
                clear: both;
            }
            #noDataError {
                color: red;
                font-size: 1.2em;
                font-weight: bold;
                display: none;
            }
            #plotControls > div > label {
                margin-right: 10px;
            }
        </style>
    </head>
    <body>
        <div style="position: absolute; top: 20px; right: 20px;">
            {% if logged-in? %}
                <a href="logout" style="font-weight: bold;">Log out</a>
            {% else %}
                <a href="login" style="font-weight: bold;">Log in</a>
            {% endif %}
        </div>
        <h2 class="leftMargin" style="margin-bottom: 15px;">Environment observations</h2>

        <div>
            <div id="tempChart" style="width: 900px; height: 400px; float: left;">
                <span id="noDataError" class="leftMargin">No observations found</span>
            </div>
            <div id="legendDiv" style="float: left;"></div>
        </div>
        <span id="plotData" style="display: none;">{{ data }}</span>

        <div id="plotControls">
            <div class="leftMargin clearBoth">
                <input type="checkbox" class="selectBox" id="showTemperature" checked="checked">
                <label for="showTemperature">Temperature</label>
                <input type="checkbox" class="selectBox" id="showBrightness" checked="checked">
                <label for="showBrightness">Brightness</label>
                <input type="checkbox" class="selectBox" id="showOutsideTemperature" checked="checked">
                <label for="showOutsideTemperature">Temperature (outside)</label>
                <input type="checkbox" class="selectBox" id="showCloudiness" checked="checked">
                <label for="showCloudiness">Cloudiness</label>
            </div>
            <br>
        </div>
        <div class="leftMargin clearBoth">
            <h4>Date interval to show</h4>
            <form method="get" action="">
                <input type="text" name="startDate" id="startDate" value="{{start-date}}">&nbsp;-&nbsp;
                <input type="text" name="endDate" id="endDate" value="{{end-date}}">
                <br><br>
                <input type="submit" class="btn btn-primary" id="submitBtn" value="Refresh">
            </form>
        </div>

        <script src="https://code.jquery.com/jquery-3.1.1.min.js"
	        integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
	        crossorigin="anonymous"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
                integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
                crossorigin="anonymous"></script>
        <script src="js/bootstrap-datepicker.min.js"></script>
        <script src="js/dygraph-combined.js"></script>
        <script src="js/plots.js"></script>
        <script>
            var datepickerOptions = {
                format: 'dd.mm.yyyy',
                weekStart: 1,
                endDate: new Date().toLocaleDateString().replace(/\//g, '.'),
                todayBtn: true,
                calendarWeeks: true
            };
            {% if not obs-dates.start|empty? %}
            datepickerOptions['startDate'] = '{{ obs-dates.start }}';
            {% endif %}
            {% if not obs-dates.end|empty? %}
            datepickerOptions['endDate'] = '{{ obs-dates.end }}';
            {% endif %}
            $('input[type="text"]').datepicker(datepickerOptions);

            // Function for validating date field values
            var validateDates = function (event) {
                var datePattern = /\d{1,2}\.\d{1,2}\.\d{4}/,
                    startDate = document.getElementById('startDate').value,
                    endDate = document.getElementById('endDate').value;

                if ((startDate && !datePattern.exec(startDate)) ||
                    (endDate && !datePattern.exec(endDate))) {
                    alert('Error: either the start or end date is invalid!');
                    event.preventDefault();
                    return;
                }
            };

            document.getElementById('submitBtn').addEventListener('click',
                                                                  validateDates,
                                                                  false);
        </script>
    </body>
</html>
